<script>
  const sendBtn = document.getElementById("sendBtn");
  const inputText = document.getElementById("inputText");
  const messages = document.getElementById("messages");

  function addMessage(text, isUser) {
    const div = document.createElement("div");
    div.className = "bubble " + (isUser ? "user" : "bot");
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  sendBtn.onclick = async () => {
    const question = inputText.value.trim();
    if (!question) return;

    addMessage(question, true);
    inputText.value = "";

    addMessage("Menjawab...", false);
    const bubbles = document.getElementsByClassName("bot");
    const current = bubbles[bubbles.length - 1];

    try {
      console.log("Mengirim ke webhook...");
      const res = await fetch("https://n8n-production-3ba7.up.railway.app/webhook/chatbot", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ chatInput: question }),
      });

      console.log("Status:", res.status);
      const text = await res.text();
      console.log("Respons dari webhook:", text);

      current.textContent = text || "(Tidak ada respons)";
    } catch (err) {
      current.textContent = "Gagal menjawab. Silakan coba lagi.";
      console.error("Fetch error:", err);
    }
  };

  inputText.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendBtn.click();
  });
</script>
